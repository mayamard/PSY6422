---
title: "PSY6422 Final Project"
author: "ID 240189002"
date: "`r Sys.Date()`"
output:
  html_document
---

```{r markdown setup, include = FALSE}

knitr::opts_chunk$set(echo = TRUE)
# Prevents "Error in contrib.url():! trying to use CRAN without setting a mirror" message
options(repos = c(CRAN = "https://cloud.r-project.org"))

```

# Topic & Research Question
## How do units of housing supply completed in the last 23 years compare across regions of England?
Given the current housing crisis and shortage in the UK, I became interested in how different regions of England specifically are performing with their supply of homes. I had a look into available data on gov.uk and the Office for National Statistics and found data on net additional dwellings completed, and on regional population figures. To allow comparisons across regions, I created a per 1000 people figure for a given region at a given year, given that bigger regions will have more housing.

# Data
## Import

```{r library and data importing, message = FALSE}

#readODS package needed to read the Net Additional Dwellings .ods dataset
if(!require(readODS)) install.packages("readODS")
library(readODS)
##readxl package needed to read the Regional Population .xlsx dataset
if(!require(readxl)) install.packages("readxl")
library(readxl)

#Library required for data wrangling
if(!require(tidyverse)) install.packages("tidyverse")
library(tidyr)
library(dplyr)

##ggplot2 allows for plotting with ggplot
if(!require(ggplot2)) install.packages("ggplot2")
library(ggplot2)
##plotly allows interactivity  from ggplot plots. I like the use of plot zooming and custom hover text which is why plotly was used
if(!require(plotly)) install.packages("plotly")
library(plotly)

#Adding data to a data frame
#Ensure data names match what I've named them below and are stored in a "data" file if you are downloading from sources yourself
data_dwell <- read_ods("data/raw_netadditionaldwellings.ods", sheet = 5)
data_pop <- read_xlsx("data/raw_population.xlsx", sheet = 11) 

#See new imported data sets are what we need
head(data_dwell)
head(data_pop)
#Will be merging these data sets so we get a figure of the number of new housing units relative to that region's population for a given year, by 1000 people to allow regional comparisons
#Data needs to match by Year and Region, therefore need to ensure relevant wrangling is completed...

```

## Wrangle: Net Additional Dwellings data

```{r wrangle net dwellings data, include = FALSE, message = FALSE}
# Wrangle: Net Additional Dwellings data

#We are looking at regions of England, from 2011 to 2023 (as no pre-2011 population data was available unfortunately)
View(data_dwell)
#Looks like we need to remove some blank columns and rows, remove the England column, rename Year column data to just numbers, remove pre-2011 data, and convert the regions to long

#remove 1st 2 rows as they are irrelevant 
data_dwell <- data_dwell[-1:-2, ]

#make first row the headings for columns, then delete first row
colnames(data_dwell) <- data_dwell[1, ]
data_dwell <- data_dwell[-1, ]

#Check if that looks right
View(data_dwell) 

#Delete "England" column as we're just seeing regional differences
data_dwell <- data_dwell %>%
  select(-"England")

#select only Net data
#Backticks `` used to select labels with spaces in them
data_dwell <- data_dwell %>% filter(
  str_starts(`Components of net housing supply`, "Net additions")
  )

#can now delete this "Components of net housing supply" column as have used filters
data_dwell <- data_dwell %>%
  select(-`Components of net housing supply`)

#rename Year as first 4 digits: cannot convert to numeric otherwise
data_dwell$Year <- str_sub(data_dwell$Year, 1, 4)

#remove data pre-2011 to match the dataset with the population data we have
data_dwell <- data_dwell %>%
  filter(Year >= 2011)

#make long
data_dwell <- pivot_longer(data_dwell, 
             cols = -Year, #all columns except year as it's already long
             names_to = "Region",
             values_to = "Net_Additional_Dwellings")

#Quick check whether we have missing data
is.na(data_dwell)
#All values come back False, meaning no missing values

#Convert to numeric to allow plotting
data_dwell$Year <- as.numeric(data_dwell$Year)
data_dwell$Net_Additional_Dwellings <- as.numeric(data_dwell$Net_Additional_Dwellings)

#How does it look?
print(data_dwell)
#Looks good!

```

## Plot: Net Additional Dwellings data

```{r plot Net Additional Dwellings data, include = FALSE, message = FALSE}

#Quick view of our data

plot_dwell <- ggplot(data = data_dwell, mapping = aes(
  x = Year, y = Net_Additional_Dwellings, 
  group = Region, colour = Region)) + 
  geom_point() + 
  geom_line() +
  labs(title = "Net Dwellings by Region, 2011-2023", 
         x = "Year", 
         y = "Net Dwellings") +
    scale_x_continuous(breaks = seq(2011, 2023))

print(plot_dwell)

```

## Wrangle: Population data

```{r wrangle population data, include = FALSE, message = FALSE}

#Check imported data
View(data_pop)
#1st column, and first 6 rows can go. will also need to rename Year headings to only numeric, and convert to long

#remove first 6 rows, no data
data_pop <- data_pop %>% slice(-1:-6)

#remove first column, no data
data_pop <- data_pop[ ,-1]

#rename headers as the first row, then remove first row
colnames(data_pop) <- data_pop[1, ]
data_pop <- data_pop[-1, ]

#rename just 1st col to Region to match Dwellings data
colnames(data_pop)[colnames(data_pop) == "Name"] <- "Region"

#view only regional data
data_pop <- data_pop %>%
  filter(grepl("Region", Geography))

#remove Geography column as now not needed
data_pop <- data_pop[ ,-2]

#convert to long
data_pop <- data_pop %>%
  pivot_longer(
    cols = starts_with("Mid"),  # Select the year columns (2011, 2012, 2013)
    names_to = "Year",         # The new column for year
    values_to = "Population"   # The new column for population values
  )

# Remove 'Mid-' from the Year column
data_pop$Year <- gsub("Mid-", "", data_pop$Year)

#Change from UPPERCASE to LikeThis
library(tools)
data_pop$Region <- toTitleCase(tolower(data_pop$Region))

#Quick check whether we have missing data
is.na(data_pop)
#All values come back FALSE, meaning no missing values

#make numeric for plot
data_pop$Year <- as.numeric(data_pop$Year)
data_pop$Population <- as.numeric(data_pop$Population)

print(data_pop)

```

## Plot: Population

```{r population plot, include = FALSE, message = FALSE}

plot_pop <- ggplot(data_pop, aes(x = Year, y = Population, group = Region, colour = Region)) +
  geom_line() +
  geom_point() +
  theme(
    plot.background = element_rect(fill = "lightblue", color = NA),
    panel.background = element_rect(fill = "white", color = NA),
    panel.grid.major = element_line(color = "gray90"),
    panel.grid.minor = element_line(color = "gray95")
  ) +
  labs(title = "Population by Region, 2011-2023", 
       x = "Year", 
       y = "Population") +
  scale_x_continuous(breaks = seq(2011, 2023))

print(plot_pop)

```

## Wrangle: Merging datasets

```{r wrangling both datasets and merging, include = FALSE, message = FALSE}

#Will want to combine the datasets to form a new data frame so Region and Year remain as columns, and Net Dwellings and Population are new
#Names of Regions and Years must be the same for all data to merge correctly, lets make sure the names are matching

#Check if we have anything earlier than 2011
any(data_dwell$Year < 2011)
#False, great!
any(data_pop$Year < 2011)
#False, great!

unique(data_dwell$Region)
unique(data_pop$Region)
#Looks like there are some differences in Region names with East and Yorkshire... 
#I prefer "East of England" and "Yorkshire and The Humber" as names from the Dwellings df, so will rename these in the Population df
#rename "East" to just "East of England", and "Yorkshire and the Humber" to "... The Humber"
data_pop <- data_pop %>%
  mutate(
    `Region` = recode(`Region`, "East" = "East of England"),
    `Region` = recode(`Region`, "Yorkshire and the Humber" = "Yorkshire and The Humber")
  )

#We can now create a new data frame where new homes are adjusted by population for each region

#merging with Region and Year labels remaining
data_final <- merge(data_dwell, data_pop, by.x = c("Region", "Year"), by.y = c("Region", "Year"))

#Check all 9 regions are here
unique(data_final$Region)
#yep
#Check all years we're interested in are accounted for
unique(data_final$Year)
#Yep
#ANy data lost in the merge, resulting in NA values?
is.na(data_final)
#All FALSE, looks good to me!

#view the data
print(data_final)

#make new columns numeric for plotting
data_final$Year <- as.numeric(data_final$Year)
data_final$Net_Additional_Dwellings <- as.numeric(data_final$Net_Additional_Dwellings)
data_final$Population <- as.numeric(data_final$Population)

# Calculate the Population/Houses*1000 ratio, create new column for figures
data_final$Dwell_By_Pop <- ((data_final$`Net_Additional_Dwellings` / data_final$`Population`)*1000)

#see the new column
View(data_final)

```

# Final Plot for Assessment

```{r final plot, echo = FALSE, message = FALSE}

# Plot it all!
plot_final <- ggplot(data_final, aes(
  x = Year, 
  y = Dwell_By_Pop, 
  group = `Region`, 
  colour = `Region`, 
  text = paste(
    Region, "|", Year, 
    "<br>Population:", format(Population, big.mark = ","), 
    "<br>Completed Builds:", format(Net_Additional_Dwellings, big.mark = ","), 
    "<br><b>Homes completed per 1000 people:</b>", round(Dwell_By_Pop, 2)))) +
  geom_line() +
  geom_point() +
  labs(title = "New Homes Completed to Population by English Region, 2011-2023", 
       x = "Year",
       y = "New Homes completed per 1000 people") +
  scale_x_continuous(
    breaks = seq(2011, 2023)) +
  scale_y_continuous(
    breaks = seq(1, 5.5, by = 0.25),
      limits = c(1, 5.5)) +
  theme(
    panel.background = element_rect(fill = "transparent", color = NA),  # Transparent panel background
    plot.background = element_rect(fill = "transparent", color = NA),  # Transparent plot background
    axis.ticks = element_line(color = "grey"),                          # Grey ticks
    panel.grid.major = element_line(color = "grey90"),                  # Optional: Light grey gridlines
    panel.grid.minor = element_line(color = "grey95")                   # Optional: Lighter grey minor gridlines
  )

# Convert ggplot to plotly for interactivity & allow custom hover text to show
plot_final <- ggplotly(plot_final, tooltip = "text")

# Show the interactive plot
plot_final

```


# Conclusions
## Limitations & Future ideas

Although my project offers an interesting insight into housing supply differences across English regions, it of course overlooks the contextual and political factors involved in housing supply. Economic conditions (e.g., unemployment, income levels), government policies (e.g., housing subsidies, planning permissions/ regulations) and details regarding types of housing or population density are not considered.

My initial idea for this project was to use data on affordable units of housing available regionally and find proportions of net housing that are affordable, to see where in England there are the most affordable options for housing. This fell short when I realised the affordable housing data is only available as a gross figure (i.e. not taking into account any losses of affordable housing), therefore any data presented would be misleading. This would be a really interesting future idea given the net data is published. There is some "Official Statistics in Development" only on affordable housing for rent, if interested (see references).

# References

All data was extracted from the Office for National Statistics and from gov.uk.

<b>Net Additional Dwellings data:</b> Table 118: annual net additional dwellings and components, England and the regions (ODS, 54KB) -<br> <a href="https://www.gov.uk/government/statistical-data-sets/live-tables-on-net-supply-of-housing#live-tables"target="_blank">https://www.gov.uk/government/statistical-data-sets/live-tables-on-net-supply-of-housing#live-tables</a> (Updated: 28 November 2024)

Involvement from:
Ministry of Housing, Communities and Local Government, 
Ministry of Housing, Communities & Local Government (2018 to 2021),
Department for Levelling Up, Housing and Communities

<b>Population estimates data:</b> Mid-2023: 2023 local authority boundaries edition of this dataset edition of this dataset (xlsx, 813.1KB) -<br> <a href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/estimatesofthepopulationforenglandandwales">https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/datasets/estimatesofthepopulationforenglandandwales</a> (Released: 15 July 2024)

<b>Unused data:</b> Links for anyone interested in affordable data sets mentioned:
<br><a href="https://www.gov.uk/government/statistical-data-sets/live-tables-on-affordable-housing-supply">https://www.gov.uk/government/statistical-data-sets/live-tables-on-affordable-housing-supply</a>
<br><a href="
https://assets.publishing.service.gov.uk/media/65c0b5dec43191000d1a451f/Net_Affordable_Housing_for_Rent.ods/preview">
https://assets.publishing.service.gov.uk/media/65c0b5dec43191000d1a451f/Net_Affordable_Housing_for_Rent.ods/preview</a>

